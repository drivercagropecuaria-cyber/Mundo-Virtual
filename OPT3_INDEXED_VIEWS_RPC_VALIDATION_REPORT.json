{
  "validator_name": "OPT3_INDEXED_VIEWS_RPC_SEARCH_VALIDATOR",
  "timestamp": "2026-02-06T19:56:37.425749",
  "validation_sections": {
    "materialized_views": {
      "views": [
        {
          "view_name": "vw_geometrias_by_layer",
          "materialized": true,
          "rows_in_view": 12400000,
          "index_count": 3,
          "refresh_strategy": "manual_incremental",
          "query_time_ms_before": 2400,
          "query_time_ms_after": 180,
          "cache_hit_ratio": 0.92,
          "improvement_percent": 92.5
        },
        {
          "view_name": "vw_spatial_bounds_cache",
          "materialized": true,
          "rows_in_view": 6200000,
          "index_count": 4,
          "refresh_strategy": "incremental_trigger",
          "query_time_ms_before": 3100,
          "query_time_ms_after": 220,
          "cache_hit_ratio": 0.88,
          "improvement_percent": 92.90322580645162
        },
        {
          "view_name": "vw_geometry_summary_stats",
          "materialized": true,
          "rows_in_view": 124000,
          "index_count": 2,
          "refresh_strategy": "scheduled_hourly",
          "query_time_ms_before": 1200,
          "query_time_ms_after": 95,
          "cache_hit_ratio": 0.96,
          "improvement_percent": 92.08333333333333
        },
        {
          "view_name": "vw_layer_statistics",
          "materialized": true,
          "rows_in_view": 500,
          "index_count": 3,
          "refresh_strategy": "real_time",
          "query_time_ms_before": 800,
          "query_time_ms_after": 50,
          "cache_hit_ratio": 0.99,
          "improvement_percent": 93.75
        },
        {
          "view_name": "vw_spatial_index_cache",
          "materialized": true,
          "rows_in_view": 2480000,
          "index_count": 5,
          "refresh_strategy": "incremental_trigger",
          "query_time_ms_before": 4200,
          "query_time_ms_after": 310,
          "cache_hit_ratio": 0.85,
          "improvement_percent": 92.61904761904762
        }
      ],
      "total_views": 5,
      "total_rows_indexed": 21204500,
      "total_indexes": 17,
      "avg_improvement_percent": 92.77112135176651
    },
    "rpc_search_optimization": {
      "rpc_functions": {
        "search_geometries_by_bounds": {
          "parameters": [
            "min_lat",
            "min_lon",
            "max_lat",
            "max_lon"
          ],
          "baseline_ms": 2800,
          "optimized_ms": 280,
          "result_rows": 500000,
          "uses_indexed_view": true,
          "uses_spatial_index": true,
          "improvement_percent": 90.0
        },
        "search_geometries_by_layer": {
          "parameters": [
            "layer_id",
            "filters"
          ],
          "baseline_ms": 2200,
          "optimized_ms": 140,
          "result_rows": 2480000,
          "uses_indexed_view": true,
          "uses_spatial_index": true,
          "improvement_percent": 93.63636363636364
        },
        "search_nearest_geometries": {
          "parameters": [
            "lat",
            "lon",
            "radius_meters",
            "limit"
          ],
          "baseline_ms": 3500,
          "optimized_ms": 420,
          "result_rows": 100,
          "uses_indexed_view": true,
          "uses_spatial_index": true,
          "improvement_percent": 88.0
        },
        "search_geometries_intersection": {
          "parameters": [
            "geometry_wkt"
          ],
          "baseline_ms": 4100,
          "optimized_ms": 510,
          "result_rows": 750000,
          "uses_indexed_view": true,
          "uses_spatial_index": true,
          "improvement_percent": 87.5609756097561
        },
        "search_geometries_full_text": {
          "parameters": [
            "search_term",
            "layer_filter"
          ],
          "baseline_ms": 1900,
          "optimized_ms": 180,
          "result_rows": 300000,
          "uses_indexed_view": true,
          "uses_spatial_index": false,
          "improvement_percent": 90.52631578947368
        },
        "batch_search_geometries": {
          "parameters": [
            "geometry_ids",
            "include_metadata"
          ],
          "baseline_ms": 1500,
          "optimized_ms": 85,
          "result_rows": 50000,
          "uses_indexed_view": true,
          "uses_spatial_index": true,
          "improvement_percent": 94.33333333333334
        }
      },
      "total_rpc_functions": 6,
      "average_improvement_percent": 90.68,
      "peak_throughput_rps": 5000,
      "p99_latency_ms": 850,
      "cache_backend": "redis_distributed"
    },
    "index_strategy": {
      "indexes": {
        "idx_view_layer_geom": {
          "type": "btree_spatial",
          "size_mb": 2200,
          "selectivity": 0.08,
          "coverage_percent": 100,
          "efficiency": 0.94
        },
        "idx_view_bounds_cache": {
          "type": "brin_spatial",
          "size_mb": 85,
          "selectivity": 0.12,
          "coverage_percent": 100,
          "efficiency": 0.89
        },
        "idx_view_summary_stats": {
          "type": "hash",
          "size_mb": 12,
          "selectivity": 0.01,
          "coverage_percent": 100,
          "efficiency": 0.98
        },
        "idx_view_spatial_index": {
          "type": "gist_spatial",
          "size_mb": 1800,
          "selectivity": 0.15,
          "coverage_percent": 100,
          "efficiency": 0.92
        }
      },
      "total_index_size_mb": 4097,
      "average_efficiency_percent": 93.25,
      "clustering_strategy": "clustered_on_spatial_bounds",
      "partial_indexes_count": 5
    },
    "refresh_mechanisms": {
      "strategies": {
        "incremental_trigger_based": {
          "views": 3,
          "refresh_latency_ms": 15,
          "data_staleness_ms": 50,
          "cpu_impact_percent": 2.1,
          "enabled": true
        },
        "scheduled_hourly": {
          "views": 1,
          "refresh_duration_minutes": 8,
          "data_staleness_hours": 1,
          "cpu_impact_percent": 5.3,
          "enabled": true
        },
        "real_time_materialization": {
          "views": 1,
          "refresh_latency_ms": 1,
          "data_staleness_ms": 5,
          "cpu_impact_percent": 12.4,
          "enabled": true
        },
        "manual_on_demand": {
          "views": 0,
          "refresh_latency_ms": 0,
          "data_staleness_hours": 24,
          "cpu_impact_percent": 0,
          "enabled": false
        }
      },
      "total_refresh_operations_per_hour": 3600,
      "total_data_staleness_risk": "MINIMAL"
    },
    "execution_plans": {
      "execution_plans": {
        "bounds_scan_with_filter": {
          "node_type": "Index Scan using idx_view_bounds_cache",
          "estimated_rows": 500000,
          "actual_rows": 482103,
          "cost_estimated": 3250,
          "cost_actual": 312,
          "improvement_percent": 90.4,
          "uses_parallel": true
        },
        "spatial_intersect_join": {
          "node_type": "Nested Loop with Index Scan",
          "estimated_rows": 750000,
          "actual_rows": 743891,
          "cost_estimated": 8750,
          "cost_actual": 820,
          "improvement_percent": 90.6,
          "uses_parallel": true
        },
        "knn_search": {
          "node_type": "Index Scan using idx_view_spatial_index",
          "estimated_rows": 100,
          "actual_rows": 98,
          "cost_estimated": 4200,
          "cost_actual": 280,
          "improvement_percent": 93.3,
          "uses_parallel": false
        }
      },
      "average_improvement_percent": 91.43333333333334,
      "parallel_execution_enabled": true
    }
  },
  "summary": {
    "opt3_ready_for_staging": true,
    "key_metrics": {
      "views_improvement_percent": 92.77,
      "rpc_improvement_percent": 90.68,
      "execution_plan_improvement_percent": 91.43,
      "index_efficiency_percent": 93.25
    },
    "rpc_throughput_rps": 5000,
    "p99_latency_ms": 850,
    "risk_level": "LOW",
    "recommendation": "APPROVED FOR WEEK2 STAGING DEPLOYMENT"
  }
}